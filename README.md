# 基于树莓派、Qt的OpenCV人脸识别签到系统

## 1. 项目目的

1. 开发板实践：掌握应用树莓派（Raspberry Pi）这一低成本、高性能的微型计算机在人脸识别领域的应用。

2. 软件开发实践：利用Qt这一跨平台的应用程序框架，开发用户友好、功能丰富的人脸识别签到系统交互界面。

3. 图像处理能力：通过OpenCV这一开源的计算机视觉库，进行人脸识别模型训练，并基于该模型进行人脸预测，提高对图像处理和分析的理解和实践能力。

4. 数据库操作：通过MySQL数据库来存在数据，掌握数据库的创建，SQL语句的编写，数据库的插入，更新与查询操作。

5. 系统集成与测试：整合树莓派、Qt、OpenCV和MySQL，构建一个完整的人脸识别签到系统，并进行系统测试其功能性。

## 2. 项目内容

1、建立树莓派TCP服务器传输视频画面

2、设计QT界面

3、Qt信号与槽

4、设计人脸识别训练与预测模型

5、设计数据库与数据库交互



## 3. 项目框架

![image-20240421095834843](https://github.com/breezs/facial-recognition-sign-system/raw/main/assets/image-20240421095834843.png)

![image-20240421094652756](https://github.com/breezs/facial-recognition-sign-system/raw/main/assets/image-20240421094652756.png)

详细高清大图，可进入网址：https://whimsical.com/raspi-opencv-qt-PbJKqzjuTn7eThsWBZ1ong



## 4. 项目功能介绍

**树莓派服务器**

> 首先在局域网下打开树莓派服务器，IP为局域网下树莓派的IP地址，此时树莓派作为服务端会监听来自客户端的请求，如果监听到则会调用自己的摄像头将所拍摄到画面传输给客户端。

 

**登录主页界面**

> 在运行程序之后，进入登录主页界面，输入账户ID及密码，点击登录按钮后，系统会去数据库中根据账户ID查询密码，如果查询成功则登录成功，解锁人脸识别界面和签到记录界面，如果查询不到这个ID或者输入的密码和数据库中的密码不相同则弹出提示对话框提示 密码错误。

> 点击注册按钮，会弹出对话框，输入个人信息以后，会将该信息存储到数据库。

 

**人脸识别界面**

> 进入人脸识别界面以后，如果点击连接，则会根据输入的IP地址与端口号连接到树莓派的TCP服务器，树莓派打开摄像头，将拍摄到的画面传输给客户端，客户端建立多线程接受服务端传递过来的人脸数据，然后调用opencv本地模型库来进行人脸验证，同时将在验证后都画面显示在人脸窗口。（人脸周围有红框，识别到就会在框中显示ID，否则显示unknown）

> 如果连接成功，则会解锁核对人脸按钮，此时会判断opencv已经验证到的人脸是否与登录ID一致，如果一致则显示当前人员的姓名并解锁签到按钮，否则继续调用Baidu-Aip进行人脸验证，如果验证成功也会解锁签到按钮，否则不解锁无法签到。

> 点击签到按钮以后，会将该人员的签到信息（签到日期，签到周期，签到时间等）存入数据库中，同时刷新签到记录窗口中显示的数据。

> 如果点击上传人脸，会判断人脸信息已经上传了，如果是，则弹出提示警告。否则进入上传人脸窗口。刚进入会直接加载当前摄像头拍摄到的画面，这种方式上传人脸优先级最高。不过也可以选择本地上传和网络获取两种方式进行采集。选择本地上传会打开文件窗口，此时可选择一张本地图片，点击确定后会加载该图片到人脸窗口；选择网络获取，打开URL对话框，可输入在线图片URL，点击确定后会获取到该网络图片到人脸窗口。点击训练，系统调用opencv进行图像训练，并将训练模型保存到模型库，训练用户集保存到user_name.txt文件中。

> 点击保存日志，会将当前登录人员的日志文件保存到log文件中，便于后续进行追踪。

 

**签到记录界面**

> 程序初始启动时，会直接去数据库中查询数据显示出来，如果签到成功，则会更新所签到人员的签到信息



## 5.启动配置

先启动命令行窗口，进入当前项目的根目录

如果使用conda，在github下载源代码以后，通过以下命令来创建项目所满足的python虚拟环境

```
conda env create -f environment.yml -n myenv
```



如果没有conda， 则当前项目的根目录使用

```
python -m venv .venv
```

创建一个虚拟环境以后，通过

```
.venv\Scripts\activate
```

激活该虚拟环境，通过一下命令安装所需要的依赖

```
 pip install -r requirements.txt -i https://pypi.tuna.tsinghua.edu.cn/simple
```

如果安装失败，则自己建一个环境，根据requirements.txt中的依赖版本号安装配置相应的环境

上面两种如果某种有问题，则试一下另外一种



安装完毕以后，建立一个mysql数据库，数据库名字为test，创建person_info以及person_sign两个表，字段设计如下

![image-20240421105123587](https://github.com/breezs/facial-recognition-sign-system/raw/main/assets/image-20240421105123587.png)

数据（可参考）

![image-20240421114507675](https://github.com/breezs/facial-recognition-sign-system/raw/main/assets/image-20240421114507675.png)



![image-20240421105138491](https://github.com/breezs/facial-recognition-sign-system/raw/main/assets/image-20240421105138491.png)



如果不想要登录直接使用，可通过修改config.py文件中Allowed = True来修改权限